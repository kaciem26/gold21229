<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily Mental Health Check-In</title>
<link rel="stylesheet" href="style.css">
  <script src="script.js"></script>

  
<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-analytics.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyAbpBMm_zpny9e8xj9bgp6wNf4sND6ty38",
    authDomain: "mentalhealthtracker-8d8cf.firebaseapp.com",
    projectId: "mentalhealthtracker-8d8cf",
    storageBucket: "mentalhealthtracker-8d8cf.firebasestorage.app",
    messagingSenderId: "234371734335",
    appId: "1:234371734335:web:c36a4468a596119930918a",
    measurementId: "G-HRKMZRVRBF"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

const loginBtn = document.getElementById("loginBtn");
const logoutBtn = document.getElementById("logoutBtn");
const userInfo = document.getElementById("userInfo");
const form = document.getElementById("checkup");
const pastEntries = document.getElementById("pastEntries");

// Login / Logout
loginBtn.addEventListener("click", () => {
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider);
});

logoutBtn.addEventListener("click", () => auth.signOut());

// Auth state listener
auth.onAuthStateChanged(user => {
  if (user) {
    loginBtn.style.display = "none";
    logoutBtn.style.display = "inline";
    form.style.display = "block";
    userInfo.textContent = `Logged in as ${user.displayName}`;
    loadPastEntries(user.uid);
  } else {
    loginBtn.style.display = "inline";
    logoutBtn.style.display = "none";
    form.style.display = "none";
    userInfo.textContent = "";
    pastEntries.innerHTML = "";
  }
});

// Form submission
form.addEventListener("submit", async e => {
  e.preventDefault();
  const user = auth.currentUser;
  if (!user) return alert("Please log in first!");

  const feelingsChecked = Array.from(document.querySelectorAll('input[name="feelings"]:checked')).map(f => f.value);
  const copingChecked = Array.from(document.querySelectorAll('input[name="coping"]:checked')).map(c => c.value);

  await db.collection("checkins").add({
    uid: user.uid,
    Sleep: document.getElementById("Sleep").value,
    sleepQuality: document.getElementById("sleepQuality").value,
    Energy: document.getElementById("Energy").value,
    appetite: document.getElementById("food").value,
    mood: document.getElementById("mood").value,
    sad: document.getElementById("sad").value,
    stress: document.getElementById("stress").value,
    anxiety: document.getElementById("anxiety").value,
    motivation: document.getElementById("motivation").value,
    focus: document.getElementById("focus").value,
    social: document.getElementById("social").value,
    feelings: feelingsChecked,
    otherFeeling: document.getElementById("otherFeeling").value,
    coping: copingChecked,
    otherCoping: document.getElementById("otherCoping").value,
    otherSymptoms: document.getElementById("otherSymptoms").value,
    date: document.getElementById("date").value,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  });

  alert("Check-in submitted!");
  form.reset();
  loadPastEntries(user.uid);
});

// Load past entries
async function loadPastEntries(uid) {
  pastEntries.innerHTML = "";
  const snapshot = await db.collection("checkins")
    .where("uid", "==", uid)
    .orderBy("timestamp", "desc")
    .get();

  snapshot.forEach(doc => {
    const data = doc.data();
    const div = document.createElement("div");
    div.style.border = "1px solid gray";
    div.style.margin = "5px";
    div.style.padding = "5px";
    div.innerHTML = `
      <strong>Date:</strong> ${data.date}<br>
      <strong>Sleep:</strong> ${data.Sleep}h, Quality: ${data.sleepQuality}<br>
      <strong>Energy:</strong> ${data.Energy}<br>
      <strong>Appetite:</strong> ${data.appetite}<br>
      <strong>Mood:</strong> ${data.mood}<br>
      <strong>Hopeless/Depressed:</strong> ${data.sad}<br>
      <strong>Stress:</strong> ${data.stress}<br>
      <strong>Anxiety:</strong> ${data.anxiety}<br>
      <strong>Motivation:</strong> ${data.motivation}<br>
      <strong>Focus:</strong> ${data.focus}<br>
      <strong>Social:</strong> ${data.social}<br>
      <strong>Feelings:</strong> ${data.feelings.join(", ")}<br>
      <strong>Coping:</strong> ${data.coping.join(", ")}<br>
      <strong>Other Feeling:</strong> ${data.otherFeeling}<br>
      <strong>Other Coping:</strong> ${data.otherCoping}<br>
      <strong>Other Notes:</strong> ${data.otherSymptoms}<br>
    `;
    pastEntries.appendChild(div);
  });
}

</script>
</head>
<body>

<h2>Daily Mental Health Check-In</h2>

<!-- Login -->
<button id="loginBtn">Login with Google</button>
<button id="logoutBtn" style="display:none;">Logout</button>
<p id="userInfo"></p>

<!-- Form -->
<form id="checkup" style="display:none;">
  <!-- Sleep -->
  <label for="Sleep">Hours of sleep (last 24h):</label>
  <input type="number" id="Sleep" name="Sleep" min="0" max="24" required><br>

  <label for="sleepQuality">Sleep quality (1–10):</label>
  <input type="number" id="sleepQuality" name="sleepQuality" min="1" max="10"><br>

  <!-- Energy -->
  <label for="Energy">Energy level (1–10):</label>
  <input type="number" id="Energy" name="Energy" min="1" max="10"><br>

  <!-- Appetite -->
  <label for="food">Appetite today:</label>
  <select id="food" name="appetite">
    <option value="decrease">Decrease</option>
    <option value="increase">Increase</option>
    <option value="stay same">Stayed the same</option>
  </select><br>

  <!-- Mood -->
  <label for="mood">Overall mood (1–10):</label>
  <input type="number" id="mood" name="mood" min="1" max="10"><br>

  <label for="sad">Feeling hopeless or depressed?</label>
  <select id="sad" name="sad">
    <option value="no">No / N/A</option>
    <option value="more than yesterday">More than yesterday</option>
    <option value="less than yesterday">Less than yesterday</option>
    <option value="the same">About the same</option>
  </select><br>

  <!-- Stress & Anxiety -->
  <label for="stress">Stress level (1–10):</label>
  <input type="number" id="stress" name="stress" min="1" max="10"><br>

  <label for="anxiety">Anxiety level (1–10):</label>
  <input type="number" id="anxiety" name="anxiety" min="1" max="10"><br>

  <!-- Motivation & Focus -->
  <label for="motivation">Motivation (1–10):</label>
  <input type="number" id="motivation" name="motivation" min="1" max="10"><br>

  <label for="focus">Focus/concentration (1–10):</label>
  <input type="number" id="focus" name="focus" min="1" max="10"><br>

  <!-- Social Interaction -->
  <label for="social">Social connection today:</label>
  <select id="social" name="social">
    <option value="none">None</option>
    <option value="some">Some</option>
    <option value="a lot">A lot</option>
  </select><br>

  <!-- Coping Strategies -->
  <label for="coping">Coping strategies used (select all that apply):</label><br>
  <input type="checkbox" name="coping" value="meditation"> Meditation<br>
  <input type="checkbox" name="coping" value="exercise"> Exercise<br>
  <input type="checkbox" name="coping" value="journaling"> Journaling<br>
  <input type="checkbox" name="coping" value="talking"> Talking with someone<br>
  <input type="checkbox" name="coping" value="other"> Other<br>
  <label for="otherCoping">If other, describe:</label>
  <input type="text" id="otherCoping" name="otherCoping"><br>

  <!-- Feelings -->
  <p>Current feelings:</p>
  <input type="checkbox" id="feeling1" name="feelings" value="excited"><label for="feeling1"> Excited</label><br>
  <input type="checkbox" id="feeling2" name="feelings" value="happy"><label for="feeling2"> Happy</label><br>
  <input type="checkbox" id="feeling3" name="feelings" value="sad"><label for="feeling3"> Sad</label><br>
  <input type="checkbox" id="feeling4" name="feelings" value="worried"><label for="feeling4"> Worried</label><br>
  <input type="checkbox" id="feeling5" name="feelings" value="tired"><label for="feeling5"> Tired</label><br>
  <input type="checkbox" id="feeling6" name="feelings" value="calm"><label for="feeling6"> Calm</label><br>
  <input type="checkbox" id="feeling7" name="feelings" value="other"><label for="feeling7"> Other</label><br>
  <label for="otherFeeling">If other, describe:</label>
  <input type="text" id="otherFeeling" name="otherFeeling"><br>

  <!-- Additional Notes -->
  <label for="otherSymptoms">Other notes/symptoms:</label>
  <input type="text" id="otherSymptoms" name="otherSymptoms"><br>

  <!-- Date -->
  <label for="date">Date:</label>
  <input type="date" id="date" name="date" required><br>

  <input type="submit">
</form>

<h3>Your Past Entries:</h3>
<div id="pastEntries"></div>

<script src="script.js"></script>
</body>
</html>
